## JWT（JSON WEB TOKEN）鉴权

> JWT就是登录成功后将相关用户信息组成 JSON 对象，然后对这个对象进行某种方式的`加密`，返回给客户端； 客户端在下次请求时带上这个 Token； 服务端再收到请求时`校验 token 合法性`，其实也就是在校验请求的合法性。

### 优劣势

- 无状态
  - 加密解密过程无需操作数据库或者缓存，是一个无状态的过程，执行效率高，而且可以在不同系统中传递，实现单点登录功能（需要各个系统的key一致）
- 缺点
  - 登录状态续签：token有效期即将到期后无法自动续签，可以前端处理获取到的token有效期快过的时候再请求一个新的token，不过也无法保障永续。
  - 旧的token无法注销：获取到新的token后，只要旧的token没有过期，还可以继续使用。解决办法有用户注销时把旧的token加黑名单等，但是这样就破坏了它本身无状态的优势，每次验证都要访问缓存

### token组成

token 一般由  `Header 头部`、 `Payload 负载` 和 `Signature 签名`三部分组成：

- header中包含了加密算法等信息，payload包含有效载荷信息，sign是签名
- payload一般需要包含expired_time、refresh_time等信息，还有自定义的信息
- 加密解密算法可用的封装：composer require firebase/php-jwt

# OAuth 2.0

**OAuth** 是一个开放标准，允许用户授权第三方网站 (CSDN、思否等) 访问他们存储在另外的服务提供者上的信息，而不需要将用户名和密码提供给第三方网站；

常见的提供 OAuth 认证服务的厂商： `支付宝、QQ、微信、微博`

OAuth 就是一种授权机制。数据的所有者告诉系统，同意授权第三方应用进入系统，获取这些数据。系统从而产生一个短期的进入令牌（Token），用来代替密码，供第三方应用使用。

令牌与密码的差异：

- 令牌是短期的，到期会自动失效：用户自己无法修改。密码一般长期有效，用户不修改，就不会发生变化
- 令牌可以被数据所有者撤销，会立即失效
- 令牌有权限范围（scope）：对于网络服务来说，只读令牌就比读写令牌更安全。密码一般是完整权限。

OAuth 2.0 对于如何颁发令牌的细节，规定得非常详细。具体来说，一共分成**四种授权**模式 **（Authorization Grant）** ，适用于不同的互联网场景，无论哪个模式都拥有三个必要角色：`客户端`、`授权服务器`、`资源服务器`，有的还有`用户（资源拥有者）`：

## 授权码模式




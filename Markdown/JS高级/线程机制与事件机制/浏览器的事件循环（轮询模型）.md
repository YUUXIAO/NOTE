---
typora-root-url: ..\..\..
---

## 事件循环

1. js的运行机制是同步任务都在主线程上运行，形成一个栈；
2. 异步任务就会放在任务队列中，等主线程的任务全部执行完之后，就会去任务队列里面看看是否存在任务需要执行；
3. 在执行主线程的任务时，如果有异步任务，会进入到 Event Table 并注册回调函数，当指定的事情完成后，会将这个回调函数放入 callback queue 中等待主线程空闲的时候被读取到栈内等待执行；
4. 在主线程执行完毕后，会去读取 callback queue 中的回调函数，进入主线程执行；
5. 不断重复的这个过程，就是 Event Loop（事件循环）；

## 同步任务

> 同步任务就是在主线程上排队执行的任务，只能执行完一个再执行下一个；

## 异步任务

> 异步任务不进入主线程，是先在 event table 中注册函数，当满足触发条件后，才可以进入任务队列中执行；

异步任务分为宏任务跟微任务，它们的区别主要是执行顺序的不同；

1. 微任务是优先于宏任务的，每次都会优先执行微任务；
2. 在每次执行一次宏任务之后，都会去看看有没有微任务需要执行；
3. 如果有，那么就是先执行微任务；

### MacroTask

常见的宏任务：script（整体代码）、setTimeout、setInterval、I/O、setImmedidate，ajax，requestAnimationFrame；

1. setImmedidate 只存在于 Node 中；
2. requestAnimationFrame 只存在于浏览器中；

### MicroTask

常见的微任务：process.nextTick、MutationObserver、Promise.then catch finally；

1. process.nextTick 的执行优先级高于 Promise 的； 
2. process.nextTic 只存在于 Node 中；
3. MutationObserver 只存在于浏览器中；

### 宏任务与微任务的执行过程

在一次事件循环中，JS会首先执行整体代码 script，执行完后会去判断微任务队列中是否有微任务，如果有，将它们逐一执行完后在一次执行宏任务；

![image](https://user-gold-cdn.xitu.io/2019/1/9/16831353b00ff06c?w=667&h=592&f=png&s=48343)

![事件循环图](/images/事件机制/事件循环图.jpg)



## 模型执行流程

1. 执行初始化代码，将事件回调函数交给对应模块管理；
2. 当事件发生时，管理模块会将回调函数及其数据添加到回调列队中；
3. 只有当初始化代码执行完成后(可能要一定时间)，才会遍历读取回调队列中的回调函数执行；


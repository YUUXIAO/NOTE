> Domain Name System（域名服务系统），DNS 协议提供的是一种主机名到 IP 地址的转换服务；

DNS 是应用层协议，通常运行在 UDP 协议之上，使用 53 端口号，基于UDP实现；它提供的是一种主机名到 IP 地址的转换服务，就是域名系统；

## 使用UDP协议作为传输层协议

> DNS 使用 UDP 协议作为传输层协议的主要原因是为了**避免使用 TCP 协议时造成的连接延迟**；

1. 为了得到一个域名的 IP 地址，往往会向多个域名服务器查询，如果使用 TCP 协议，那么每次请求都会存在连接延迟，使得 DNS 服务变得很慢；
2. 大多数的地址查询请求，都是浏览器请求页面时发出的，这样会造成网页等待的时间过长；

## 查询过程

1. **浏览器搜索自身的 DNS 缓存：**首先浏览器会搜索自身的 DNS 缓存，看缓存是否过期，过期的话缓存的解析就结束了；
2. **搜索操作系统自身的 DNS 缓存：**浏览器会搜索操作系统自身的缓存，没有找到或失效的话，解析结束；
3. **读取本地的 hosts 文件：**浏览器会读取本地的 hosts 文件（Hosts文件可以建立域名到IP地址的绑定关系，可以通过编辑Hosts文件来达到名称解析的目的）；
4. **请求本地 DNS 服务器：**

   - 本地 DNS 服务器可以认为是你的网络接入服务商提供，比如电信；如果该服务器有缓存就直接返回；

5. **根域名服务器迭代请求：**查询请求发出后，域名服务器代为向下一级域名服务器发出请求，返回查询的最终结果，用户只需发出一次查询请求；

   - 询问根域名，获取顶级域名；
   - 询问顶级域名，获取二级域名；
   - ....
   - 最后，将网站的 ip 地址返回给用户，并且缓存；
   - 用户获取到真正的ip地址，并且缓存；


## DNS缓存

在一个请求中，当某个DNS服务器收到一个DNS回答后，它能够回答中的信息缓存在本地存储器中，返回的资源记录中的 TTL 代表了该条记录的缓存的时间；

## 实现负载平衡

DNS 是可以实现负载平衡，因为一般的大型网站使用多台服务器提供服务，因此一个域名可能会对应 多个服务器地址；

1. 当用户发起网站域名的 DNS 请求的时候，DNS 服务器返回这个域名所对应的服务器 IP 地址的集合；
2. 在每个回答中，会循环这些 IP 地址的顺序，用户一般会选择排在前面的地址发送请求；
3. 以此将用户的请求均衡的分配到各个不同的服务器上，这样来实现负载均衡；

## DNS优化

### 减少查询次数

1. DNS查询需要时间，但是 DNS 可以在浏览器和计算机中缓存一段时间，一般只是首次加载网页时会对域名进行解析；
2. 尽量减少不同 domain 的请求的数量，比如将外部的资源提前下载到同域名的服务器上等；

### 预解析

> 预解析就是当加载一个html时，会自动解析其中 a 标签所包含的 href 链接为IP地址，并缓存；

在HTTPS页面中，不会自动预解析，所以需要手动添加；

```javascript
<link rel="dns-prefetch" href="//img.alicdn.com">
```

可以开启自动对所有链接的解析；

```javascript
<meta http-equiv="x-dns-prefetch-control" content="on">
```